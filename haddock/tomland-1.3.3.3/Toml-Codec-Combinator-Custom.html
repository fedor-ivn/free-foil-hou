<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Toml.Codec.Combinator.Custom</title><link href="linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">tomland-1.3.3.3: Bidirectional TOML serialization</span><ul class="links" id="page-menu"><li><a href="src/Toml.Codec.Combinator.Custom.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>(c) 2018-2022 Kowainik</td></tr><tr><th>License</th><td>MPL-2.0</td></tr><tr><th>Maintainer</th><td>Kowainik &lt;xrom.xkov@gmail.com&gt;</td></tr><tr><th>Stability</th><td>Stable</td></tr><tr><th>Portability</th><td>Portable</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Toml.Codec.Combinator.Custom</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1"><code>Text</code> combinators</a></li><li><a href="#g:2">Validation</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Contains TOML-specific custom combinators for converting between TOML and
special user data types.</p><p>See examples below of the situations you may need the following combinators.</p><p><em>Since: 1.3.0.0</em></p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:textBy">textBy</a> :: (a -&gt; <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a>) -&gt; (<a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> a) -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li><li class="src short"><a href="#v:read">read</a> :: (<a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.19.1.0/Text-Read.html#t:Read" title="Text.Read">Read</a> a) =&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li><li class="src short"><a href="#v:enumBounded">enumBounded</a> :: (<a href="../base-4.19.1.0/Prelude.html#t:Bounded" title="Prelude">Bounded</a> a, <a href="../base-4.19.1.0/Prelude.html#t:Enum" title="Prelude">Enum</a> a, <a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a) =&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li><li class="src short"><a href="#v:hardcoded">hardcoded</a> :: (<a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.19.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> a) =&gt; a -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li><li class="src short"><a href="#v:validate">validate</a> :: (a -&gt; <a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> a) -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li><li class="src short"><a href="#v:validateIf">validateIf</a> :: (a -&gt; <a href="../base-4.19.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a</li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1><code>Text</code> combinators</h1></a><div class="top"><p class="src"><a id="v:textBy" class="def">textBy</a> :: (a -&gt; <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a>) -&gt; (<a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> -&gt; <a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> a) -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#textBy" class="link">Source</a> <a href="#v:textBy" class="selflink">#</a></p><div class="doc"><p>Codec for text values with custom error messages for parsing.</p><p><strong>Example:</strong></p><p>We have the following type that represents the image format:</p><pre><strong>data</strong> Format
    = Jpeg
    | Png
    | Gif
    <strong>deriving</strong> (<code><a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a></code>, <code><a href="../base-4.19.1.0/Text-Read.html#t:Read" title="Text.Read">Read</a></code>, <code><a href="../base-4.19.1.0/Prelude.html#t:Enum" title="Prelude">Enum</a></code>)
</pre><p>But we want to be able to decode and encode this data type through the custom
text representation, that can be formilised in the following functions:</p><pre>showFormat :: Format -&gt; <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code>
showFormat = case
    Jpeg -&gt; &quot;.jpeg&quot;
    Png  -&gt; &quot;.png&quot;
    Gif  -&gt; &quot;.gif&quot;

parseFormat :: <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code> -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a></code> <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code> Format
parseFormat = <strong>case</strong>
    &quot;.jpeg&quot; -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#v:Right" title="Data.Either">Right</a></code> Jpeg
    &quot;.png&quot;  -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#v:Right" title="Data.Either">Right</a></code> Png
    &quot;.gif&quot;  -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#v:Right" title="Data.Either">Right</a></code> Gif
    other   -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#v:Left" title="Data.Either">Left</a></code> $ &quot;Unsupported format: &quot; &lt;&gt; other
</pre><p>To write the codec for <code>Format</code> data type using the above rules we can use
<code><a href="Toml-Codec-Combinator-Custom.html#v:textBy" title="Toml.Codec.Combinator.Custom">textBy</a></code> combinator:</p><pre>formatCodec :: <code><a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a></code> -&gt; <code><a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a></code> Format
formatCodec = <code><a href="Toml-Codec-Combinator-Custom.html#v:textBy" title="Toml.Codec.Combinator.Custom">textBy</a></code> showFormat parseFormat
</pre><p>And now with the <code>formatCodec &quot;foo&quot;</code> we can have the following line in our
<code>TOML</code> perfectly encoded:</p><pre>foo = &quot;.gif&quot;
</pre><p>But the <code>foo = &quot;jif&quot;</code> will lead to the following error:</p><pre>tomland decode error:  Unsupported format: jif
</pre><p><em>Since: 1.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:read" class="def">read</a> :: (<a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.19.1.0/Text-Read.html#t:Read" title="Text.Read">Read</a> a) =&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#read" class="link">Source</a> <a href="#v:read" class="selflink">#</a></p><div class="doc"><p>Codec for values with a <code><a href="../base-4.19.1.0/Text-Read.html#t:Read" title="Text.Read">Read</a></code> and <code><a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a></code> instance.</p><p><strong>Example:</strong></p><p>We have the following type that represents the image format:</p><pre><strong>data</strong> Format
    = Jpeg
    | Png
    | Gif
    deriving (Show, Read, Enum)
</pre><p>And we want to be able to decode and encode this data type through the <code><a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a></code>
and <code><a href="../base-4.19.1.0/Text-Read.html#t:Read" title="Text.Read">Read</a></code> instances.</p><p>To write the codec for <code>Format</code> data type using the existing instances we can
use <code><a href="Toml-Codec-Combinator-Custom.html#v:read" title="Toml.Codec.Combinator.Custom">read</a></code> combinator. And now with the <code>Toml.<code><a href="Toml-Codec-Combinator-Custom.html#v:read" title="Toml.Codec.Combinator.Custom">read</a></code> &quot;foo&quot;</code> we can have the
following line in our <code>TOML</code> perfectly encoded:</p><pre>foo = <a href="Gif.html">Gif</a>
</pre><p>But the <code>foo = &quot;.gif&quot;</code> will lead to the following error:</p><pre>tomland decode error:  Prelude.read: no parse
</pre><p><em>Since: 0.5.0</em></p></div></div><div class="top"><p class="src"><a id="v:enumBounded" class="def">enumBounded</a> :: (<a href="../base-4.19.1.0/Prelude.html#t:Bounded" title="Prelude">Bounded</a> a, <a href="../base-4.19.1.0/Prelude.html#t:Enum" title="Prelude">Enum</a> a, <a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a) =&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#enumBounded" class="link">Source</a> <a href="#v:enumBounded" class="selflink">#</a></p><div class="doc"><p>Codec for general nullary sum data types with a <code><a href="../base-4.19.1.0/Prelude.html#t:Bounded" title="Prelude">Bounded</a></code>, <code><a href="../base-4.19.1.0/Prelude.html#t:Enum" title="Prelude">Enum</a></code>, and
<code><a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a></code> instance. This codec is similar to <code><a href="Toml-Codec-Combinator-Custom.html#v:read" title="Toml.Codec.Combinator.Custom">read</a></code> but provides much better error
messages than <code><a href="Toml-Codec-Combinator-Custom.html#v:read" title="Toml.Codec.Combinator.Custom">read</a></code> for nullary sum types.</p><p>E.g. for the same <code>Format</code> example from <code><a href="Toml-Codec-Combinator-Custom.html#v:read" title="Toml.Codec.Combinator.Custom">read</a></code> function, but with the
<code>Toml.<code><a href="Toml-Codec-Combinator-Custom.html#v:enumBounded" title="Toml.Codec.Combinator.Custom">enumBounded</a></code> &quot;foo&quot;</code> codec the error for <code>foo = &quot;Jif&quot;</code> in the <code>TOML</code> file
will look like this:</p><pre>tomland decode error:  Value is <code>Jif</code> but expected one of: Jpeg, Png, Gif
</pre><p><em>Since: 1.1.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:hardcoded" class="def">hardcoded</a> :: (<a href="../base-4.19.1.0/Text-Show.html#t:Show" title="Text.Show">Show</a> a, <a href="../base-4.19.1.0/Data-Eq.html#t:Eq" title="Data.Eq">Eq</a> a) =&gt; a -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#hardcoded" class="link">Source</a> <a href="#v:hardcoded" class="selflink">#</a></p><div class="doc"><p>Codec for hardcoded provided values and its <code>BiMap</code>.</p><p>If you want to decode a single key-value pair where only one value is allowed.
Like in the example below:</p><pre>scope = &quot;all&quot;
</pre><p>To decode that you could use the following function:</p><pre>Toml.hardcoded &quot;all&quot; Toml._Text &quot;scope&quot;
</pre><p>in case if the value in <code>TOML</code> is not the same as hardcoded, you will get the following error:</p><pre>tomland decode error:  BiMap error in key <code>scope</code> : Value '&quot;foo&quot;' doesn't align with the hardcoded value '&quot;all&quot;'
</pre><p><em>Since: 1.3.2.0</em></p></div></div><a href="#g:2" id="g:2"><h1>Validation</h1></a><div class="top"><p class="src"><a id="v:validate" class="def">validate</a> :: (a -&gt; <a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a> <a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a> a) -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#validate" class="link">Source</a> <a href="#v:validate" class="selflink">#</a></p><div class="doc"><p>Codec that checks the <code>BiMap</code> on the given predicate.
The predicate function returns the value, if the validation is successful, or
the <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code> of the error that should be returned in case of validation failure.</p><p><strong>Example:</strong></p><p>Let's imagine that we want to have the list in <code>TOML</code> that could only
have even <code><a href="../base-4.19.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></code>s inside. In this case, you can write the following codec:</p><pre>allEven :: [<code><a href="../base-4.19.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></code>] -&gt; <code><a href="../base-4.19.1.0/Data-Either.html#t:Either" title="Data.Either">Either</a></code> <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code> [<code><a href="../base-4.19.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></code>]
allEven xs =
    if all even xs
    then <code><a href="../base-4.19.1.0/Data-Either.html#v:Right" title="Data.Either">Right</a></code> xs
    else <code><a href="../base-4.19.1.0/Data-Either.html#v:Left" title="Data.Either">Left</a></code> &quot;This is wrong, I asked you for even only :(&quot;

allEvenCodec :: <code><a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a></code> [<code><a href="../base-4.19.1.0/Data-Int.html#t:Int" title="Data.Int">Int</a></code>]
allEvenCodec = Toml.<code><a href="Toml-Codec-Combinator-Custom.html#v:validate" title="Toml.Codec.Combinator.Custom">validate</a></code> allEven (Toml._Array Toml._Int) &quot;myEvenList&quot;
</pre><p>Then in your <code>TOML</code> file you can have:</p><pre>myEvenList = [2, 4, 6]
</pre><p>But the following one will lead to the error:</p><pre>myEvenList = [1, 2, 3]
</pre><pre>tomland decode error:  This is wrong, I asked you for even only :(
</pre><p><em>Since: 1.3.0.0</em></p></div></div><div class="top"><p class="src"><a id="v:validateIf" class="def">validateIf</a> :: (a -&gt; <a href="../base-4.19.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a>) -&gt; <a href="Toml-Codec-BiMap.html#t:TomlBiMap" title="Toml.Codec.BiMap">TomlBiMap</a> a <a href="Toml-Type-AnyValue.html#t:AnyValue" title="Toml.Type.AnyValue">AnyValue</a> -&gt; <a href="Toml-Type-Key.html#t:Key" title="Toml.Type.Key">Key</a> -&gt; <a href="Toml-Codec-Types.html#t:TomlCodec" title="Toml.Codec.Types">TomlCodec</a> a <a href="src/Toml.Codec.Combinator.Custom.html#validateIf" class="link">Source</a> <a href="#v:validateIf" class="selflink">#</a></p><div class="doc"><p>Similar to <code><a href="Toml-Codec-Combinator-Custom.html#v:validate" title="Toml.Codec.Combinator.Custom">validate</a></code> but takes the predicate that returnes <code><a href="../base-4.19.1.0/Data-Bool.html#t:Bool" title="Data.Bool">Bool</a></code>.
The error in case of the validation failure looks like this:</p><pre>Value does not pass the validation for key: KEY_NAME
</pre><p><strong>Example:</strong></p><p>Let's imagine that we want to have the <code><a href="../text-2.1.1/Data-Text.html#t:Text" title="Data.Text">Text</a></code> field in <code>TOML</code> that could only
have 3 chars in it. In this case, you can write the following codec:</p><pre>my3charTextCodec :: TomlCodec Text
my3CharTextCodec = Toml.<code><a href="Toml-Codec-Combinator-Custom.html#v:validateIf" title="Toml.Codec.Combinator.Custom">validateIf</a></code> ((==) 3 . Text.length) Toml._Text &quot;myKeyName&quot;
</pre><p>The in your <code>TOML</code> file you can have:</p><pre>myKeyName = &quot;abc&quot;
</pre><p>But the following one will lead to the error:</p><pre>myKeyName = &quot;I have more than enough&quot;
</pre><pre>tomland decode error:  Value does not pass the validation for key: myKeyName
</pre><p><em>Since: 1.3.0.0</em></p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.30.0</p></div></body></html>